<section class="corporate-enquiry" aria-labelledby="corporate-enquiry-heading">
  <div class="corporate-enquiry__inner">
    <p id="corporate-enquiry-heading" class="corporate-enquiry__copy">
      We organize corporate, team-building, and private events — to create yours…
    </p>
    <button type="button" class="book-btn corporate-enquiry__trigger" data-modal-target="corporate-enquiry-modal">
      Enquire Now
    </button>
  </div>
</section>

<div class="corporate-modal" id="corporate-enquiry-modal" role="dialog" aria-modal="true" aria-labelledby="corporate-modal-title" hidden>
  <div class="corporate-modal__backdrop" data-modal-close></div>
  <div class="corporate-modal__dialog" role="document">
    <button type="button" class="corporate-modal__close" aria-label="Close enquiry form" data-modal-close>
      ×
    </button>
    <div class="corporate-modal__content">
      <div class="corporate-modal__header">
        <h2 id="corporate-modal-title">Plan Your Event with Games Lab</h2>
      </div>
      <div class="corporate-modal__body">
        <div class="corporate-modal__frame">
          <iframe
            src="https://forms.zohopublic.in/infogame1/form/CorporateEventEnquiry/formperma/U6qIOzComB_KEFFu44Sy3mp57NtCr0-1qvUt-kVjCrI/formEmbed?zf_rszfm=1"
            title="Corporate Event Enquiry"
            loading="lazy"
            frameborder="0"
            allowtransparency="true"
            allow="geolocation"
          ></iframe>
        </div>
        <p class="corporate-modal__note">
          Having trouble? <a href="https://forms.zohopublic.in/infogame1/form/CorporateEventEnquiry/formperma/U6qIOzComB_KEFFu44Sy3mp57NtCr0-1qvUt-kVjCrI" target="_blank" rel="noopener">Open the form in a new tab</a>.
        </p>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  const modal = document.getElementById('corporate-enquiry-modal');
  if (!modal) return;

  const html = document.documentElement;
  const content = modal.querySelector('.corporate-modal__body');
  const triggers = document.querySelectorAll('[data-modal-target="corporate-enquiry-modal"]');
  const closeButtons = modal.querySelectorAll('[data-modal-close]');
  let lastFocused = null;
  let scrollPosition = 0;

  function openModal(){
    if (!modal.hasAttribute('hidden')) return;
    lastFocused = document.activeElement;
    scrollPosition = window.pageYOffset || document.documentElement.scrollTop || 0;
    modal.removeAttribute('hidden');
    html.classList.add('corporate-modal-open');
    document.body.classList.add('corporate-modal-open');
    document.body.style.top = `-${scrollPosition}px`;
    if (content){
      content.scrollTop = 0;
    }
    window.setTimeout(() => {
      const firstInput = modal.querySelector('iframe, button, [href], input, select, textarea');
      (firstInput || modal).focus({ preventScroll: true });
    }, 10);
    modal.addEventListener('keydown', handleKeydown);
  }

  function closeModal(){
    if (modal.hasAttribute('hidden')) return;
    modal.setAttribute('hidden', '');
    html.classList.remove('corporate-modal-open');
    document.body.classList.remove('corporate-modal-open');
    document.body.style.removeProperty('top');
    modal.removeEventListener('keydown', handleKeydown);
    window.scrollTo(0, scrollPosition);
    if (lastFocused && typeof lastFocused.focus === 'function'){
      lastFocused.focus({ preventScroll: true });
    }
  }

  function handleKeydown(event){
    if (event.key === 'Escape'){
      event.preventDefault();
      closeModal();
    } else if (event.key === 'Tab'){
      trapFocus(event);
    }
  }

  function trapFocus(event){
    const focusable = Array.from(modal.querySelectorAll('button, [href], input, select, textarea, iframe, [tabindex]:not([tabindex="-1"])'))
      .filter(el => !el.hasAttribute('hidden') && !el.closest('[hidden]') && !el.disabled);
    if (!focusable.length) return;
    const first = focusable[0];
    const last = focusable[focusable.length - 1];
    if (event.shiftKey && document.activeElement === first){
      event.preventDefault();
      last.focus();
    } else if (!event.shiftKey && document.activeElement === last){
      event.preventDefault();
      first.focus();
    }
  }

  triggers.forEach(button => {
    button.addEventListener('click', openModal);
  });

  closeButtons.forEach(button => {
    button.addEventListener('click', closeModal);
  });

  modal.addEventListener('click', event => {
    if (event.target && event.target.hasAttribute('data-modal-close')){
      closeModal();
    }
  });
})();
</script>
