{%- comment -%}
  _includes/event-sections.html
  Purpose: Render structured copy from the matching collection item at the TOP,
  then (optionally) the "About the event" video and "Event recaps" grid.

  Assumptions:
  - Collection: site.events with items having front matter fields:
      about, what_makes_it_different, how_it_works, why_join, closing
  - Current page has `slug` matching the collection item's `slug`.
  - Optional page fields:
      page.about_video              → string URL OR object { url, thumb }
      page.about_video_thumb        → string URL (fallback thumbnail)
      page.recap_videos             → array of strings OR objects { url, title, thumb }
{%- endcomment -%}

{%- comment -%} 1) Structured sections (TOP) {%- endcomment -%}
{% assign ev = site.events | where: "slug", page.slug | first %}
{% if ev %}

  {% if ev.about %}
  <section class="section">
    <h2>About Night of Mafias</h2>
    <div class="prose">{{ ev.about | markdownify }}</div>
  </section>
  {% endif %}

  {% if ev.what_makes_it_different %}
  <section class="section">
    <h2>What makes it different</h2>
    <div class="prose">{{ ev.what_makes_it_different | markdownify }}</div>
  </section>
  {% endif %}

  {% if ev.how_it_works %}
  <section class="section">
    <h2>How it works</h2>
    <div class="prose">{{ ev.how_it_works | markdownify }}</div>
  </section>
  {% endif %}

  {% if ev.why_join %}
  <section class="section">
    <h2>Why join?</h2>
    <div class="prose">{{ ev.why_join | markdownify }}</div>
  </section>
  {% endif %}

  {% if ev.closing %}
  <section class="section">
    <div class="prose">{{ ev.closing | markdownify }}</div>
  </section>
  {% endif %}

{% endif %}

{%- comment -%} 2) Optional "About the event" video (guarded; heading clarified) {%- endcomment -%}
{% if page.about_video %}
  {%- assign about_url = page.about_video -%}
  {%- if page.about_video.url -%}{% assign about_url = page.about_video.url %}{%- endif -%}
  {%- assign about_thumb = page.about_video_thumb | default: page.about_video.thumb | default: '/assets/fallback-video-thumb.jpg' -%}

  <section class="section" id="about-event">
    <h2>About the event</h2>
    <div class="video-wrap">
      <a class="video-landscape" data-embed href="{{ about_url | escape }}">
        <img src="{{ about_thumb | escape }}" alt="About video" loading="lazy">
        <span class="play">▶</span>
      </a>
    </div>
  </section>
{% endif %}

{%- comment -%} 3) Optional Event Recaps grid (guarded) {%- endcomment -%}
{% if page.recap_videos and page.recap_videos.size > 0 %}
  <section class="section" id="event-recaps">
    <h2>Event recaps</h2>
    <div class="recaps-grid">
      {% for v in page.recap_videos %}
        {%- assign v_url = v -%}
        {%- assign v_title = "Recap video" -%}
        {%- assign v_thumb = '/assets/fallback-video-thumb.jpg' -%}

        {%- if v.url -%}{% assign v_url = v.url %}{%- endif -%}
        {%- if v.title -%}{% assign v_title = v.title %}{%- endif -%}
        {%- if v.thumb -%}{% assign v_thumb = v.thumb %}{%- endif -%}

        <a class="video-portrait" data-embed href="{{ v_url | escape }}">
          <img src="{{ v_thumb | escape }}" alt="{{ v_title | escape }}" loading="lazy">
          <span class="play">▶</span>
        </a>
      {% endfor %}
    </div>
  </section>
{% endif %}
