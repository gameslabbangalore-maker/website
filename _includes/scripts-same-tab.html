<script>
(function(){
  // Force same-tab for all links on the page (including content added later).
  // Opt-out: add data-newtab="true" on any <a> you want to keep opening in a new tab.
  function fix(root=document){
    root.querySelectorAll('a[target]').forEach(a => {
      if (a.hasAttribute('data-newtab')) return; // allowlist
      a.removeAttribute('target');
      a.removeAttribute('rel');
    });
  }

  // Run now / on DOM ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => fix());
  } else {
    fix();
  }

  // Watch for dynamically inserted links
  new MutationObserver(muts => {
    muts.forEach(m => m.addedNodes.forEach(n => {
      if (n.nodeType !== 1) return;
      if (n.tagName === 'A') fix(n.parentNode || document);
      else fix(n);
    }));
  }).observe(document.documentElement, { childList: true, subtree: true });
})();
</script>
