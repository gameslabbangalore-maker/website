{% assign upcoming = site.data.event_schedule.upcoming | default: [] %}
{% assign fallback_image = 'https://via.placeholder.com/800x450?text=Event+Image' %}
<div class="title"><h2>Upcoming Events</h2></div>
<div id="upcoming-cards" class="cards-row">
  {% if upcoming.size > 0 %}
    {% for item in upcoming %}
      {% assign banner = item.banner | to_s %}
      {% if banner contains 'imagekit.io' and banner contains '/tr:' %}
        {% assign banner_url = banner %}
      {% elsif banner contains 'imagekit.io' %}
        {% assign banner_url = banner | replace_first: 'imagekit.io/', 'imagekit.io/tr:w-800,h-450,fo-auto/' %}
      {% elsif banner != '' %}
        {% assign banner_url = banner %}
      {% else %}
        {% assign banner_url = fallback_image %}
      {% endif %}
      {% assign page_url = item.page_url | default: '/' | relative_url %}
      <article class="card">
        <div class="media">
          <img src="{{ banner_url | escape }}" alt="{{ item.title | default: 'Event image' }}" loading="lazy" width="800" height="450" />
        </div>
        <div class="card-body">
          <h3 class="event-title">{{ item.title }}</h3>
          <p class="meta">
            {% if item.date_label %}{{ item.date_label }}{% endif %}
            {% if item.date_label and item.time_label %} | {% endif %}
            {% if item.time_label %}{{ item.time_label }}{% endif %}
          </p>
          {% if item.location_name %}
          <p class="location">{{ item.location_name }}</p>
          {% endif %}
          <p class="mobile-info">
            {% if item.location_name %}{{ item.location_name }}{% endif %}
            {% if item.location_name and item.time_label %} | {% endif %}
            {% if item.time_label %}{{ item.time_label }}{% endif %}
          </p>
        </div>
        {% if item.day or item.month %}
        <div class="card-date">
          {% if item.day %}<div class="day">{{ item.day }}</div>{% endif %}
          {% if item.month %}<div class="month">{{ item.month }}</div>{% endif %}
          <div class="time"></div>
        </div>
        {% endif %}
        <div class="card-footer">
          <a class="book-btn" href="{{ page_url }}" target="_self">Details</a>
        </div>
      </article>
    {% endfor %}
  {% else %}
    <div style="color:#bbb;text-align:center;">No upcoming events.</div>
  {% endif %}
</div>
<script>
(function(){
  var container = document.getElementById('upcoming-cards');
  if (!container) return;
  var cards = container.querySelectorAll('.card');
  cards.forEach(function(card){
    var link = card.querySelector('.book-btn');
    if (!link) return;
    card.addEventListener('click', function(ev){
      if (ev.target.closest('a,button')) return;
      if (window.innerWidth <= 768) {
        window.location.href = link.href;
      }
    });
  });
})();
</script>
